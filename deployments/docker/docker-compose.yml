version: "3.8"

services:
  pmhq:
    image: linyuchen/pmhq:latest
    platform: linux/amd64
    container_name: luckylillia-pmhq
    restart: unless-stopped
    privileged: true
    environment:
      - ENABLE_HEADLESS=false
      - AUTO_LOGIN_QQ=
    volumes:
      - ../../data/llbot/qq:/root/.config/QQ
      - ../../data/llbot/data:/app/llbot/data
    networks:
      - llbot_net

  # QQ 协议层 - LuckyLilliaBot (LLBot Docker 版)
  luckylillia:
    image: linyuchen/llbot:latest
    platform: linux/amd64
    container_name: luckylillia
    restart: unless-stopped
    env_file:
      - ../../configs/.env
      - ../../configs/secrets/.env
    environment:
      - ENABLE_WEBUI=true
      - WEBUI_PORT=3080
    entrypoint:
      - /bin/sh
      - /config/llbot-entrypoint.sh
    ports:
      - "3000:3000"
      - "3080:3080"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      - ../../data/llbot/data:/app/llbot/data
      - ../../data/llbot/qq:/root/.config/QQ
      - ../../data/llbot/default_config.json:/config/default_config.json:ro
      - ../../scripts/llbot-entrypoint.sh:/config/llbot-entrypoint.sh:ro
    depends_on:
      - pmhq
    networks:
      - llbot_net

networks:
  llbot_net:
    driver: bridge
