# Runtime Selection: Bun vs Node.js

## 背景

在确定使用 TypeScript 作为开发语言后，我们需要选择合适的运行时环境。主要的选项是成熟的 **Node.js** 和新兴的 **Bun**。

## 关键考量因素

| 维度           | Node.js                                        | Bun                                                  |
| :------------- | :--------------------------------------------- | :--------------------------------------------------- |
| **成熟度**     | ⭐⭐⭐⭐⭐ 行业标准，生态极其丰富              | ⭐⭐⭐ 快速发展中，基本兼容 Node API                 |
| **性能**       | ⭐⭐⭐ V8 引擎，性能良好                       | ⭐⭐⭐⭐⭐ Zig 编写，启动和运行速度极快              |
| **工具链**     | 需组合使用 (npm/yarn + vitest + tsc + nodemon) | ⭐⭐⭐⭐⭐ All-in-One (内置包管理、测试、构建、监听) |
| **包管理**     | npm/yarn/pnpm (较慢)                           | 内置 (极快)                                          |
| **TypeScript** | 需配置 loader (ts-node/tsx) 或编译             | ⭐⭐⭐⭐⭐ 原生支持，零配置                          |

## 决策

**决策**：使用 **Bun**

**日期**：2025-01-09

**理由**：

1.  **开发体验**：Bun 原生支持 TypeScript，无需复杂的 `tsc`/`ts-node` 配置，且内置了 `watch` 模式，开发迭代反馈更快。
2.  **工具链统一**：Bun 提供了内置的包管理器（替代 npm/pnpm）、测试运行器（替代 Vitest/Jest）和构建工具，减少了依赖项和配置复杂度。
3.  **性能**：在容器化部署场景下，Bun 的快速启动特性有助于提高伸缩效率。
4.  **兼容性**：虽然是新运行时，但在本项目的规划范围内（Web Server, WebSocket, AI SDK），Bun 对 Node.js API 的兼容性已足够满足需求。

## 后果

1.  **环境依赖**：开发和部署环境必须安装 Bun，而不是 Node.js。
2.  **潜在坑**：某些极少数依赖 Node.js 内部实现的深层库可能会遇到兼容性问题（需关注 `milky-node-sdk` 的兼容性）。
3.  **学习成本**：团队需要熟悉 `bun` 命令行工具，虽然它大部分兼容 `npm` 命令。
