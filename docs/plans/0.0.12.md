# 0.0.12 Plan: 打通 Opencode 调用链

> 注：本文件为历史计划记录，实际实现以当前代码与文档为准。

## 目标

让系统可以真实调用 `opencode` CLI，解析 JSON 输出，并把结果写入历史与响应队列。

## 关键任务

### 1) 启动参数统一

- [x] 在 `src/opencode/launcher.ts` 构造 `opencode -p -c -f json` 命令参数
- [ ] 保持只读/读写路径与工作目录约束不变

### 2) Runner 输出解析

- [x] 在 `src/worker/runner.ts` 解析 `opencode` 的 JSON 输出
- [x] 生成 `HistoryEntry[]` 并返回 `output` 以写回历史与响应队列

### 3) 集成验证

- [ ] 确认 Worker -> Runner -> History/Response 路径可通

## 验证计划

- [ ] 手动：运行一次消息，确认输出进入 history 与响应队列
