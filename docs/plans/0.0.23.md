0.0.23 Plan: Discord 适配器实现
目标
实现 DiscordAdapter，基于 discord.js 接入 Discord 平台，填补 src/adapters/factory.ts 中的空白。
核心原则
不造轮子：直接使用 discord.js 处理 Gateway 连接和分片。不要自己去写 WebSocket 解析。
数据结构优先：核心难点在于将 Discord 复杂的 Message 对象映射到我们简化的 SessionEvent。映射必须准确，特别是 Mention 和 Channel ID。
保持接口一致：对上层 MessageDispatcher 来说，它不应该知道底层是 QQ 还是 Discord。
关键任务

1. 依赖引入

安装 discord.js (Bun 运行时)。

确保 bun.lockb 更新。2) 适配器实现 (src/adapters/discord/)
创建以下文件结构，保持与 QQ 适配器类似的职责分离：
adapter.ts: 实现 PlatformAdapter。管理 Client 生命周期。
必须配置正确的 Intents: Guilds, GuildMessages, MessageContent (这是关键，没有这个就是瞎子)。
parser.ts: 最关键的部分。
将 Message 转换为 SessionEvent。
处理 Mention：Discord 的 <@userid> 需要被正确识别并转换为我们的 SessionElement。
忽略 Bot 自己的消息。
sender.ts:
实现消息发送。
支持文本回复。
支持 Embeds (作为 SessionEvent 的 extras 扩展，或者基础的文本 fallback)。3) 工厂集成

修改 src/adapters/factory.ts，移除 throw Error，实例化 DiscordAdapter。

确保 config.ts 中的 Token 和 App ID 校验逻辑生效。4) 触发逻辑适配

检查 src/entry/trigger.ts 中的 mentionsSelf 逻辑。
目前已有 getSelfMentionPattern 针对 Discord 的正则 <@!?id>，需要验证其在真实 Discord ID 下的有效性。
验证计划
连接测试：PLATFORM=discord 启动，日志显示 Logged in as ...。
接收测试：在 Discord 频道发送消息，日志应输出解析后的 SessionEvent，特别是 content 和 elements 必须清晰。
发送测试：Bot 能针对消息进行 Echo 或 AI 回复。
风险点
Intents 权限：Discord Developer Portal 上必须手动开启 MESSAGE CONTENT INTENT，否则收不到消息内容。代码里救不了配置错误。
用户 ID 格式：QQ 是数字，Discord 是 Snowflake (String)。目前的系统设计已经全部转为 string，应该没问题，但要注意任何隐式的数字转换。
