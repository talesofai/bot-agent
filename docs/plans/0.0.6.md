# 0.0.6 Bug Fixes

> 注：本文件为历史计划记录，实际实现以当前代码与文档为准。

目标：修复代码审查中发现的 4 个问题。

## 问题列表

### 1. [高] 重连定时器重复调度

**文件**：`src/adapters/qq/connection.ts:237-255`

**问题**：`scheduleReconnect()` 没有在调度前检查/清理已有 `reconnectTimer`，如果 error/close 事件短时间密集触发，会堆积多个定时器导致并发重连。

**修复**：在 `scheduleReconnect()` 开头清理已有定时器。

---

### 2. [中] MILKY_URL 未做校验

**文件**：`src/adapters/qq/adapter.ts:32-44`

**问题**：虽然 0.0.5 添加了 url 检查，但错误信息不够直观，应明确说明需要 MILKY_URL。

**修复**：改进错误信息，明确指出是 MILKY_URL 配置缺失。

---

### 3. [中] frontmatter 解析 CRLF 问题

**文件**：`src/store/group.ts:240-258`

**问题**：正则 `/^---\n([\s\S]*?)\n---\n([\s\S]*)$/` 仅匹配 `\n`，CRLF 行尾或末尾无换行时 frontmatter 会被当成正文。

**修复**：正则改为支持 `\r?\n`，并处理末尾无换行的情况。

---

### 4. [低] ensureGroupDir 不修复已有目录

**文件**：`src/store/group.ts:93-107`

**问题**：`ensureGroupDir` 只在目录不存在时创建默认文件，已有目录缺少 agent.md/config.yaml/子目录不会修复。

**修复**：改为逐个检查并创建缺失的子目录和默认文件。

## 验证

- [ ] TypeScript 类型检查通过
- [ ] 测试套件通过
