# 0.0.9 Plan: 稳定性与缺陷修复

> 注：本文件为历史计划记录，实际实现以当前代码与文档为准。

## 目标

修复已知缺陷与运行一致性问题，降低运行风险。

## 关键任务

### 1) 运行与部署一致性

- [x] Dockerfile 运行路径与 build 产物一致（`dist/` 或直接 `src/`）
- [x] 文档与实现对齐：HTTP API 现状说明

### 2) 运行稳定性

- [x] Redis 锁续期失败的处理策略（连续失败时中止任务或主动失败）
- [x] BullMQ stalled 配置完善（`stalledInterval`/`maxStalledCount`）

### 3) 健壮性与可维护性

- [x] `readTail` 截断边界改进（结合 `maxEntries`）
- [x] `echoCounter` 增长策略（重置或 UUID）
- [x] 配置加载支持测试隔离（避免顶层锁死）
- [x] 日志脱敏策略（避免直接记录用户原始内容）
- [x] 替换 FakeWebSocket 的测试策略（更贴近真实实现）
- [x] `UnifiedMessage.raw` 类型细化

## 验证计划

- [ ] Redis 短暂故障时锁续期策略行为符合预期
- [ ] BullMQ stalled 恢复策略生效
- [ ] Docker 镜像启动路径与构建产物一致
